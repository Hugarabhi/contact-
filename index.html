<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GAANYOGI TOURS AND TRAVELS </title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Manrope:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <style>
        /* Custom Color Palette */
        :root {
            --electric-blue: #00a8e8;
            --tea-green: #d4e09b;
            --cream: #fdf7ec;
            --sunset: #ff6b6b;
            --melon: #ff9a8b;
            --midnight: #1a1a2e;
            --slate: #394867;
        }

        body {
            background-color: var(--cream);
            color: var(--midnight);
            font-family: 'Manrope', sans-serif;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        /* Smooth scrolling for the whole page */
        html {
            scroll-behavior: smooth;
        }

        /* Hide scrollbar but keep functionality */
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }

        /* Custom animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .animate-fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        .animate-slide-in {
            animation: slideIn 0.5s ease-out;
        }

        /* Gradient backgrounds */
        .gradient-bg {
            background: linear-gradient(135deg, var(--electric-blue) 0%, var(--tea-green) 100%);
        }

        .gradient-sunset {
            background: linear-gradient(135deg, var(--sunset) 0%, var(--melon) 100%);
        }

        /* Card hover effects */
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        /* Mobile tap targets */
        .mobile-tap {
            min-height: 44px;
            min-width: 44px;
        }

        /* Glass morphism effect */
        .glass {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(0, 168, 232, 0.1);
            border-radius: 10px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: var(--electric-blue);
            border-radius: 10px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: var(--slate);
        }

        /* Loader */
        .loader {
            border: 3px solid rgba(0, 168, 232, 0.2);
            border-radius: 50%;
            border-top: 3px solid var(--electric-blue);
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }

        /* Text truncation */
        .line-clamp-2 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 2;
        }
    </style>

    <!-- Tailwind Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 
                        sans: ['Manrope', 'sans-serif'], 
                        serif: ['Playfair Display', 'serif'] 
                    },
                    colors: {
                        'electric': '#00a8e8',
                        'teagreen': '#d4e09b',
                        'cream': '#fdf7ec',
                        'sunset': '#ff6b6b',
                        'melon': '#ff9a8b',
                        'midnight': '#1a1a2e',
                        'slate': '#394867'
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.6s ease-out',
                        'slide-in': 'slideIn 0.5s ease-out',
                        'float': 'float 3s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' }
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="antialiased min-h-screen flex flex-col">
    <!-- Navigation -->
    <nav class="glass sticky top-0 z-50 shadow-sm animate-fade-in">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-2 cursor-pointer" onclick="router.navigate('home')">
                <div class="w-9 h-9 rounded-full bg-gradient-to-br from-electric to-teagreen flex items-center justify-center text-white font-serif text-lg shadow-lg">
                    G
                </div>
                <div>
                    <h1 class="text-lg font-serif font-bold tracking-widest text-midnight">GAANYOGI</h1>
                    <p class="text-[8px] text-electric font-bold uppercase tracking-[0.2em]">BOOK FOR SAFETY AND SECURE PICK AND DROP <I>LUXURY|SEFTY|CLEAN|FAST|TRUST</I></p>
                </div>
            </div>
            
            <div class="hidden md:flex gap-6 text-sm font-semibold text-slate">
                <button onclick="router.navigate('home')" class="hover:text-electric transition py-2 border-b-2 border-transparent hover:border-electric">Home</button>
                <button onclick="router.navigate('tours')" class="hover:text-electric transition py-2 border-b-2 border-transparent hover:border-electric">Luxury Tours</button>
                <button onclick="router.navigate('rides')" class="hover:text-electric transition py-2 border-b-2 border-transparent hover:border-electric">Book Ride</button>
                <button onclick="router.navigate('admin')" class="hover:text-electric transition py-2 border-b-2 border-transparent hover:border-electric">Admin</button>
            </div>

            <div class="flex items-center gap-3">
                <div id="user-status" class="hidden md:block text-xs text-electric font-bold bg-electric/10 px-3 py-1 rounded-full">
                    <i class="fa-solid fa-user mr-1"></i> Guest
                </div>
                <button onclick="router.navigate('rides')" class="hidden md:block gradient-sunset text-white px-5 py-2 rounded-full text-xs font-bold uppercase tracking-wider hover:opacity-90 transition shadow-lg mobile-tap">
                    <i class="fa-solid fa-car-side mr-2"></i> BOOK A RIDE
                </button>
                <button onclick="toggleMobileMenu()" class="md:hidden text-midnight text-xl p-2 mobile-tap">
                    <i class="fa-solid fa-bars"></i>
                </button>
            </div>
        </div>
        
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden glass border-t border-gray-100 p-5 flex flex-col gap-4 animate-slide-in">
             <button onclick="router.navigate('home'); toggleMobileMenu()" class="text-left text-midnight font-bold py-3 text-base flex items-center">
                <i class="fa-solid fa-home mr-3 text-electric"></i>Home
             </button>
             <button onclick="router.navigate('tours'); toggleMobileMenu()" class="text-left text-midnight font-bold py-3 text-base flex items-center">
                <i class="fa-solid fa-map-marked-alt mr-3 text-sunset"></i>Luxury Tours
             </button>
             <button onclick="router.navigate('rides'); toggleMobileMenu()" class="text-left text-midnight font-bold py-3 text-base flex items-center">
                <i class="fa-solid fa-car mr-3 text-melon"></i>Book Ride
             </button>
             <button onclick="router.navigate('admin'); toggleMobileMenu()" class="text-left text-midnight font-bold py-3 text-base flex items-center">
                <i class="fa-solid fa-lock mr-3 text-slate"></i>Admin
             </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main id="app-root" class="flex-grow"></main>

    <!-- Footer -->
    <footer class="bg-midnight text-white py-10 mt-20">
        <div class="container mx-auto px-4 grid grid-cols-1 md:grid-cols-3 gap-8">
            <div>
                <h3 class="font-serif text-xl font-bold mb-4 text-teagreen">GAANYOGI</h3>
                <p class="text-gray-300 text-sm leading-relaxed">Secure Journeys, Eternal Memories. Premium travel experiences across India's finest landscapes.</p>
            </div>
            <div>
                <h3 class="font-serif text-lg font-bold mb-4 text-white">Concierge Desk</h3>
                <p class="text-gray-300 text-sm mb-3 flex items-center">
                    <i class="fa-brands fa-whatsapp mr-3 text-teagreen"></i>+91 8975029616
                </p>
                <p class="text-gray-300 text-sm flex items-center">
                    <i class="fa-solid fa-envelope mr-3 text-teagreen"></i>AVINASHHUGAR299@GMAIL.COM 
                </p>
            </div>
            <div>
                <h3 class="font-serif text-lg font-bold mb-4 text-white">Connect</h3>
                <div class="flex gap-4 text-xl">
                    <a href="#" class="text-gray-400 hover:text-teagreen transition hover:scale-110"><i class="fa-brands fa-instagram"></i></a>
                    <a href="#" class="text-gray-400 hover:text-teagreen transition hover:scale-110"><i class="fa-brands fa-facebook"></i></a>
                    <a href="#" class="text-gray-400 hover:text-teagreen transition hover:scale-110"><i class="fa-brands fa-twitter"></i></a>
                </div>
            </div>
        </div>
        <div class="text-center text-gray-500 text-[10px] uppercase tracking-widest mt-8 border-t border-white/10 pt-6">
            &copy; 2026 GAANYOGI tours and travles 
            <p>build|deploy :avinashhugar299@gmail.com </p>
        </div>
    </footer>

    <!-- AI Chat Widget -->
    <div class="fixed bottom-4 right-4 z-50 animate-fade-in">
        <div id="chat-window" class="hidden bg-white w-full max-w-sm h-[400px] rounded-2xl shadow-2xl flex flex-col mb-4 border border-electric/20 hide-scrollbar">
            <div class="gradient-bg p-4 text-white flex justify-between items-center rounded-t-2xl">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center text-white border border-white/30">
                        <i class="fa-solid fa-robot"></i>
                    </div>
                    <div>
                        <p class="font-bold text-sm font-serif">GAANYOGI HELPS !!</p>
                        <p class="text-[10px] opacity-90 uppercase">TravelING HELP </p>
                    </div>
                </div>
                <button onclick="toggleChat()" class="hover:bg-white/20 rounded-full w-8 h-8 flex items-center justify-center transition mobile-tap">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div id="chat-messages" class="flex-1 p-4 overflow-y-auto bg-cream text-sm space-y-3 custom-scrollbar hide-scrollbar">
                <div class="flex justify-start animate-slide-in">
                    <div class="bg-white p-3 rounded-2xl rounded-tl-none border border-electric/20 max-w-[85%] text-midnight shadow-sm">
                        Namaste! I am GAANYOGI HELPS, your AI travelling helps !!. How can I assist with your journey today?
                    </div>
                </div>
            </div>
            <div class="p-3 bg-white border-t border-electric/10 flex gap-2 rounded-b-2xl">
                <input type="text" id="chat-input" placeholder="Ask about tours, rides, or destinations..." 
                       class="flex-1 bg-cream border border-electric/20 rounded-xl px-4 py-2 text-sm text-midnight focus:outline-none focus:ring-2 focus:ring-electric focus:border-transparent">
                <button onclick="handleChatSend()" class="bg-electric text-white w-10 h-10 rounded-xl flex items-center justify-center hover:bg-electric/90 transition shadow mobile-tap">
                    <i class="fa-solid fa-paper-plane"></i>
                </button>
            </div>
        </div>
        <button onclick="toggleChat()" class="gradient-sunset text-white w-14 h-14 rounded-full shadow-xl flex items-center justify-center hover:scale-105 transition-transform shadow-lg mobile-tap animate-float">
            <i class="fa-solid fa-comment-dots text-xl"></i>
        </button>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed top-20 right-4 z-[70] flex flex-col gap-3 w-auto max-w-[300px] pointer-events-none"></div>

    <!-- Modal Container -->
    <div id="modal-container"></div>

    <!-- External Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Firebase Scripts -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, serverTimestamp, query, orderBy, limit, onSnapshot, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD3OCCZJIEL1cjeMfM5A7aZ-4Eh-1DWiIg",
            authDomain: "gaanyogitours.firebaseapp.com",
            projectId: "gaanyogitours",
            storageBucket: "gaanyogitours.firebasestorage.app",
            messagingSenderId: "884166466732",
            appId: "1:884166466732:web:f09efbb5c3ab937f371309"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Application State
        const state = {
            user: null,
            isAdminVerified: false,
            map: null,
            ride: {
                step: 'INPUT',
                pickup: '',
                drop: '',
                distance: 0,
                loading: false,
                selectedVehicle: null,
                fixedPrice: null
            }
        };

        // Data
        const RIDE_OFFERS = [
            { id: 'off1', from: 'Mumbai Airport', to: 'Lonavala', price: 2999, img: 'https://images.unsplash.com/photo-1596739956461-8f5539d89953?q=80&w=400&auto=format&fit=crop', vehicle: 'Sedan Prime', duration: '2h 30m' },
            { id: 'off2', from: 'Pune', to: 'Shirdi', price: 3499, img: 'https://images.unsplash.com/photo-1563293887-827c7d1e8476?q=80&w=400&auto=format&fit=crop', vehicle: 'SUV Comfort', duration: '3h 15m' },
            { id: 'off3', from: 'Bangalore', to: 'Mysore', price: 3999, img: 'https://images.unsplash.com/photo-1590050752117-238cb0fb12b1?q=80&w=400&auto=format&fit=crop', vehicle: 'Innova Crysta', duration: '3h' },
            { id: 'off4', from: 'Mumbai', to: 'Pune', price: 2499, img: 'https://images.unsplash.com/photo-1566552881560-0be862a7c445?q=80&w=400&auto=format&fit=crop', vehicle: 'Sedan Prime', duration: '2h 45m' }
        ];

        const TOURS = [
            { id: 't001', title: 'Mystical Hampi', region: 'Karnataka', duration: '3 Days', price: 18500, rating: 4.8, image: 'https://images.unsplash.com/photo-1582555490422-9252c7b20536?q=80&w=400&auto=format&fit=crop', desc: 'Ancient ruins of Vijayanagara empire.', highlights: ['Coracle Ride', 'Sunset Point', 'Cave Temples'] },
            { id: 't002', title: 'Konkan Bliss', region: 'Maharashtra', duration: '4 Days', price: 22000, rating: 4.9, image: 'https://images.unsplash.com/photo-1571406452293-c9183b38148b?q=80&w=400&auto=format&fit=crop', desc: 'Pristine beaches and scuba diving.', highlights: ['Scuba Diving', 'Fort Visit', 'Beach Bonfire'] },
            { id: 't003', title: 'Coorg Hills', region: 'Karnataka', duration: '3 Days', price: 15500, rating: 4.7, image: 'https://images.unsplash.com/photo-1596176530529-78163a4f7af2?q=80&w=400&auto=format&fit=crop', desc: 'Coffee plantations and misty hills.', highlights: ['Coffee Tasting', 'Abbey Falls', 'Elephants'] },
            { id: 't004', title: 'Kerala Backwaters', region: 'Kerala', duration: '5 Days', price: 28500, rating: 4.9, image: 'https://images.unsplash.com/photo-1529107386315-e1a2ed48a620?q=80&w=400&auto=format&fit=crop', desc: 'Serene houseboat cruise.', highlights: ['Houseboat Stay', 'Ayurvedic Spa', 'Kathakali Show'] }
        ];

        const VEHICLES = [
            { id: 'v1', name: 'Gaanyogi ertiga ', type: 'Sedan (AC)', seats: 7, rate: 15, img: 'ertiga.png', color: 'electric' },
            { id: 'v2', name: 'Gaanyogi ertiga ', type: '(NON-AC)', seats: 7, rate: 14, img: 'ertiga.png', color: 'sunset' },
            { id: 'v3', name: 'Gaanyogi FORCE CRUISER ', type: 'Luxury (NON-AC)', seats: 14, rate: 18, img: 'cruiser.png', color: 'melon' },
            { id: 'v4', name: 'Gaanyogi FORCE CRUISER ', type: 'Luxury (AC)', seats: 14, rate: 19, img: 'cruiser.png', color: 'melon' }
        ];

        // Authentication
        async function initAuth() {
            try {
                await signInAnonymously(auth);
            } catch (error) {
                console.log("Auth:", error);
            }
            
            onAuthStateChanged(auth, (user) => {
                state.user = user;
                if (user) {
                    document.getElementById('user-status').innerHTML = `<i class="fa-solid fa-user mr-1"></i> Guest`;
                    document.getElementById('user-status').classList.remove('hidden');
                }
            });
        }

        // Router
        const router = {
            navigate: (route, params) => {
                const root = document.getElementById('app-root');
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
                document.getElementById('mobile-menu').classList.add('hidden');
                
                if(route === 'home') renderHome(root);
                else if(route === 'tours') renderTours(root);
                else if(route === 'tour-detail') renderTourDetail(root, params);
                else if(route === 'booking') renderBooking(root, params);
                else if(route === 'rides') renderRides(root);
                else if(route === 'admin') renderAdmin(root);
            }
        };

        // Render Functions
        function renderHome(container) {
            container.innerHTML = `
                <section class="relative h-[75vh] w-full overflow-hidden animate-fade-in">
                    <div class="absolute inset-0">
                        <img src="https://images.unsplash.com/photo-1545232979-8bf68ee0523f?q=80&w=1600" 
                             class="w-full h-full object-cover" 
                             alt="Luxury Travel">
                        <div class="absolute inset-0 bg-gradient-to-r from-cream/95 via-cream/80 to-transparent"></div>
                    </div>
                    
                    <div class="relative h-full flex flex-col justify-center px-4 md:px-24">
                        <div class="max-w-2xl animate-slide-in">
                            <span class="text-electric font-bold tracking-[0.2em] text-xs uppercase mb-4 block">Premium Chauffeur Services</span>
                            <h1 class="font-serif text-4xl md:text-6xl text-midnight mb-4 leading-tight">Elevate Your <span class="text-sunset italic">Journey.</span></h1>
                            <p class="text-slate text-lg mb-8 max-w-lg">Experience the finest chauffeur services and curated luxury tours across India.</p>
                            <div class="flex flex-col sm:flex-row gap-4">
                                <button onclick="router.navigate('rides')" 
                                        class="gradient-sunset text-white px-8 py-4 rounded-full font-bold uppercase tracking-widest text-xs hover:opacity-90 transition shadow-lg mobile-tap">
                                    <i class="fa-solid fa-car-side mr-2"></i>Book Chauffeur
                                </button>
                                <button onclick="router.navigate('tours')" 
                                        class="bg-white text-midnight border-2 border-electric/30 px-8 py-4 rounded-full font-bold uppercase tracking-widest text-xs hover:bg-electric/10 transition mobile-tap">
                                    <i class="fa-solid fa-map-marked-alt mr-2"></i>View Itineraries
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="container mx-auto px-4 py-12 -mt-20 relative z-10">
                    <div class="mb-8">
                        <span class="text-sunset font-bold tracking-[0.2em] text-xs uppercase block mb-2">Limited Time</span>
                        <h2 class="font-serif text-2xl md:text-3xl text-midnight mb-2">Exclusive Drop Offers</h2>
                        <p class="text-slate text-sm">Pre-booked routes at fixed prices</p>
                    </div>

                    <div class="flex gap-4 overflow-x-auto pb-6 custom-scrollbar hide-scrollbar px-2">
                        ${RIDE_OFFERS.map(offer => `
                            <div class="min-w-[280px] bg-white rounded-2xl shadow-lg overflow-hidden border border-electric/20 card-hover flex-shrink-0">
                                <div class="h-40 overflow-hidden relative">
                                    <img src="${offer.img}" class="w-full h-full object-cover">
                                    <div class="absolute top-3 left-3 bg-white/90 px-3 py-1 rounded-full text-xs font-bold text-electric">
                                        <i class="fa-solid fa-clock mr-1"></i>${offer.duration}
                                    </div>
                                </div>
                                <div class="p-5">
                                    <div class="flex justify-between items-start mb-4">
                                        <div>
                                            <div class="flex items-center gap-2 text-midnight font-bold text-lg mb-1">
                                                <span>${offer.from.split(' ')[0]}</span>
                                                <i class="fa-solid fa-arrow-right text-sunset"></i>
                                                <span>${offer.to}</span>
                                            </div>
                                            <p class="text-xs text-slate uppercase">${offer.vehicle}</p>
                                        </div>
                                        <div class="text-right">
                                            <p class="text-2xl font-serif text-sunset font-bold">₹${offer.price}</p>
                                            <p class="text-[10px] text-slate line-through">₹${offer.price + 500}</p>
                                        </div>
                                    </div>
                                    <button onclick="bookOffer('${offer.id}')" 
                                            class="w-full bg-electric/10 text-electric py-3 rounded-xl font-bold text-xs uppercase tracking-widest hover:bg-electric hover:text-white transition mobile-tap">
                                        <i class="fa-solid fa-bolt mr-2"></i>Book Now
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </section>

                <section class="bg-cream/50 py-16">
                    <div class="container mx-auto px-4">
                        <div class="text-center mb-12">
                            <span class="text-melon font-bold tracking-[0.3em] text-xs uppercase mb-3 block">Featured Escapes</span>
                            <h2 class="font-serif text-2xl md:text-3xl text-midnight mb-4">Popular Tour Packages</h2>
                            <p class="text-slate max-w-2xl mx-auto">Curated experiences for discerning travelers</p>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            ${TOURS.map(tour => `
                                <div class="bg-white rounded-2xl overflow-hidden shadow-lg hover:shadow-xl transition-all cursor-pointer border border-electric/10 card-hover" 
                                     onclick="router.navigate('tour-detail', '${tour.id}')">
                                    <div class="h-48 overflow-hidden">
                                        <img src="${tour.image}" class="w-full h-full object-cover hover:scale-105 transition duration-500">
                                    </div>
                                    <div class="p-6">
                                        <div class="flex justify-between items-start mb-3">
                                            <h3 class="font-serif text-xl text-midnight hover:text-electric transition-colors">${tour.title}</h3>
                                            <span class="text-xs text-slate font-bold">${tour.region}</span>
                                        </div>
                                        <p class="text-slate text-sm mb-4 line-clamp-2">${tour.desc}</p>
                                        <div class="flex justify-between items-center">
                                            <div class="text-sunset font-bold text-lg">₹${tour.price.toLocaleString()}</div>
                                            <span class="text-xs text-electric font-bold uppercase tracking-wider flex items-center">
                                                Explore <i class="fa-solid fa-arrow-right ml-2"></i>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="text-center mt-12">
                            <button onclick="router.navigate('tours')" 
                                    class="bg-white text-midnight border-2 border-electric px-8 py-3 rounded-full font-bold uppercase tracking-widest text-xs hover:bg-electric hover:text-white transition mobile-tap">
                                View All Tours <i class="fa-solid fa-arrow-right ml-2"></i>
                            </button>
                        </div>
                    </div>
                </section>

                <section class="py-16">
                    <div class="container mx-auto px-4">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                            <div class="text-center">
                                <div class="w-16 h-16 gradient-bg rounded-2xl mx-auto flex items-center justify-center text-white text-2xl mb-6">
                                    <i class="fa-solid fa-leaf"></i>
                                </div>
                                <h3 class="font-serif text-xl font-bold text-midnight mb-3">Eco-Conscious</h3>
                                <p class="text-slate text-sm px-4">Sustainable tourism practices across all our journeys.</p>
                            </div>
                            <div class="text-center">
                                <div class="w-16 h-16 gradient-sunset rounded-2xl mx-auto flex items-center justify-center text-white text-2xl mb-6">
                                    <i class="fa-solid fa-shield-halved"></i>
                                </div>
                                <h3 class="font-serif text-xl font-bold text-midnight mb-3">Premium Safety</h3>
                                <p class="text-slate text-sm px-4">24/7 verified chauffeurs and secure digital payments.</p>
                            </div>
                            <div class="text-center">
                                <div class="w-16 h-16 bg-gradient-to-br from-melon to-sunset rounded-2xl mx-auto flex items-center justify-center text-white text-2xl mb-6">
                                    <i class="fa-solid fa-robot"></i>
                                </div>
                                <h3 class="font-serif text-xl font-bold text-midnight mb-3">AI Concierge</h3>
                                <p class="text-slate text-sm px-4">Personalized recommendations via Yogi AI assistant.</p>
                            </div>
                        </div>
                    </div>
                </section>
            `;
        }

        function renderRides(container) {
            const { step, pickup, drop, distance, loading } = state.ride;

            container.innerHTML = `
                <div class="relative min-h-[calc(100vh-140px)] w-full animate-fade-in">
                    <div id="map" class="absolute inset-0"></div>
                    
                    <div class="relative w-full md:w-[480px] bg-white/95 backdrop-blur-sm z-10 md:ml-4 md:my-4 md:rounded-2xl shadow-2xl border border-electric/20">
                        <div class="gradient-bg p-6 text-white rounded-t-2xl md:rounded-t-2xl">
                            <h2 class="font-serif text-2xl mb-2">Book Your Journey</h2>
                            <p class="text-white/90 text-sm">Luxury chauffeur services across India</p>
                        </div>

                        <div class="p-4 md:p-6 overflow-y-auto max-h-[70vh] custom-scrollbar">
                            <div class="mb-6">
                                <h3 class="text-xs font-bold text-sunset uppercase tracking-widest mb-3 flex items-center">
                                    <i class="fa-solid fa-bolt mr-2"></i>Hot Deals
                                </h3>
                                <div class="flex gap-3 overflow-x-auto pb-4 custom-scrollbar hide-scrollbar">
                                    ${RIDE_OFFERS.map(o => `
                                        <div onclick="bookOffer('${o.id}')" 
                                             class="min-w-[200px] bg-cream border border-electric/20 p-4 rounded-xl cursor-pointer hover:border-sunset transition mobile-tap">
                                            <div class="flex justify-between items-center mb-2">
                                                <div>
                                                    <div class="text-sm font-bold text-midnight">${o.to}</div>
                                                    <div class="text-[10px] text-slate">From ${o.from}</div>
                                                </div>
                                                <span class="text-sm font-bold text-sunset">₹${o.price}</span>
                                            </div>
                                            <div class="text-[10px] text-slate flex items-center">
                                                <i class="fa-solid fa-car mr-1"></i> ${o.vehicle}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>

                            <div class="${step === 'INPUT' ? 'block' : 'hidden'} space-y-4">
                                <div>
                                    <label class="text-xs uppercase tracking-widest text-midnight font-bold mb-2 block flex items-center">
                                        <i class="fa-solid fa-location-dot mr-2 text-electric"></i>Pickup Location
                                    </label>
                                    <input id="pickup-input" value="${pickup}" 
                                           class="w-full bg-cream border border-electric/20 rounded-xl p-3 text-midnight focus:border-electric focus:ring-2 focus:ring-electric/20 outline-none text-sm mobile-tap"
                                           placeholder="e.g. Mumbai Airport">
                                </div>
                                <div>
                                    <label class="text-xs uppercase tracking-widest text-midnight font-bold mb-2 block flex items-center">
                                        <i class="fa-solid fa-map-pin mr-2 text-melon"></i>Destination
                                    </label>
                                    <input id="drop-input" value="${drop}" 
                                           class="w-full bg-cream border border-electric/20 rounded-xl p-3 text-midnight focus:border-electric focus:ring-2 focus:ring-electric/20 outline-none text-sm mobile-tap"
                                           placeholder="e.g. Taj Mahal">
                                </div>
                                <button onclick="estimateRide()" 
                                        class="w-full gradient-sunset text-white font-bold py-3.5 rounded-xl hover:opacity-90 flex items-center justify-center gap-2 mobile-tap shadow-lg"
                                        ${loading ? 'disabled' : ''}>
                                    ${loading ? 
                                        `<div class="loader w-5 h-5 border-white/20 border-t-white"></div> Calculating...` : 
                                        `Calculate Fare <i class="fa-solid fa-calculator ml-1"></i>`
                                    }
                                </button>
                            </div>

                            <div class="${step === 'LIST' ? 'block animate-slide-in' : 'hidden'}">
                                <div class="flex justify-between items-center border-b border-electric/10 pb-4 mb-6">
                                    <div>
                                        <span class="text-xs text-slate uppercase tracking-widest font-bold">Distance</span>
                                        <div class="text-2xl font-serif text-midnight mt-1">${distance.toFixed(1)} <span class="text-sm text-sunset">km</span></div>
                                    </div>
                                    <button onclick="state.ride.step='INPUT'; renderRides(document.getElementById('app-root'))" 
                                            class="text-xs text-electric hover:text-sunset font-bold mobile-tap">
                                        <i class="fa-solid fa-pencil mr-1"></i>Change
                                    </button>
                                </div>
                                
                                <h3 class="text-xs font-bold text-midnight uppercase tracking-widest mb-4">Select Vehicle</h3>
                                <div class="space-y-4">
                                    ${VEHICLES.map(v => {
                                        const fare = Math.round(distance * v.rate);
                                        const colorClass = v.color === 'electric' ? 'border-electric/30 hover:border-electric' : 
                                                          v.color === 'sunset' ? 'border-sunset/30 hover:border-sunset' : 
                                                          'border-melon/30 hover:border-melon';
                                        const bgClass = v.color === 'electric' ? 'bg-electric/5' : 
                                                       v.color === 'sunset' ? 'bg-sunset/5' : 
                                                       'bg-melon/5';
                                        return `
                                        <div onclick="openBookingModal('${v.id}')" 
                                             class="${bgClass} border ${colorClass} rounded-xl p-4 hover:shadow-lg transition-all cursor-pointer flex items-center gap-4 mobile-tap card-hover">
                                            <div class="w-16 h-12 rounded-lg bg-white overflow-hidden">
                                                <img src="${v.img}" class="w-full h-full object-cover">
                                            </div>
                                            <div class="flex-1">
                                                <h4 class="text-midnight font-bold text-sm">${v.name}</h4>
                                                <div class="flex items-center gap-2 mt-1">
                                                    <span class="text-[10px] uppercase font-bold bg-white text-slate px-2 py-0.5 rounded">${v.type}</span>
                                                    <span class="text-[10px] text-slate">
                                                        <i class="fa-solid fa-user mr-1"></i>${v.seats} Seats
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="text-right">
                                                <div class="text-sunset font-bold text-lg">₹${fare.toLocaleString()}</div>
                                                <div class="text-[10px] text-slate">₹${v.rate}/km</div>
                                            </div>
                                        </div>
                                    `}).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            setTimeout(() => {
                if (!state.map && document.getElementById('map')) {
                    state.map = L.map('map', { 
                        zoomControl: false,
                        scrollWheelZoom: false
                    }).setView([19.0760, 72.8777], 10);
                    
                    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                        attribution: '&copy; OpenStreetMap'
                    }).addTo(state.map);
                    
                    L.marker([19.0760, 72.8777])
                        .addTo(state.map)
                        .bindPopup('Mumbai Central')
                        .openPopup();
                }
            }, 100);
        }

        function renderTours(container) {
            container.innerHTML = `
                <div class="container mx-auto px-4 py-8 animate-fade-in">
                    <div class="mb-8 md:mb-12 text-center">
                        <span class="text-melon font-bold tracking-[0.3em] text-xs uppercase mb-3 block">Bespoke Itineraries</span>
                        <h1 class="font-serif text-3xl md:text-4xl text-midnight mb-4">Curated Escapes</h1>
                        <p class="text-slate max-w-2xl mx-auto">Discover handpicked luxury tours across India's most breathtaking destinations</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-6 md:gap-8">
                        ${TOURS.map(t => `
                            <div class="bg-white rounded-2xl overflow-hidden shadow-lg hover:shadow-xl transition-all cursor-pointer border border-electric/10 card-hover" 
                                 onclick="router.navigate('tour-detail', '${t.id}')">
                                <div class="h-56 md:h-64 overflow-hidden relative">
                                    <img src="${t.image}" class="w-full h-full object-cover hover:scale-105 transition duration-500">
                                    <div class="absolute top-4 right-4 bg-white/90 px-3 py-1 rounded-full text-xs font-bold text-electric shadow-sm">
                                        <i class="fa-solid fa-star text-sunset mr-1"></i> ${t.rating}
                                    </div>
                                    <div class="absolute bottom-4 left-4 bg-electric text-white text-[10px] font-bold px-3 py-1.5 rounded-full uppercase tracking-wider">
                                        ${t.duration}
                                    </div>
                                </div>
                                <div class="p-6">
                                    <div class="flex justify-between items-start mb-3">
                                        <h3 class="font-serif text-xl text-midnight hover:text-electric transition-colors">${t.title}</h3>
                                        <span class="text-xs text-slate font-bold">${t.region}</span>
                                    </div>
                                    <p class="text-slate text-sm mb-4 line-clamp-2">${t.desc}</p>
                                    <div class="flex justify-between items-center border-t border-electric/10 pt-4">
                                        <div class="text-sunset font-bold text-xl">₹${t.price.toLocaleString()}</div>
                                        <div class="text-xs text-electric font-bold uppercase tracking-wider flex items-center">
                                            View Details <i class="fa-solid fa-arrow-right ml-2"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>`;
        }

        function renderTourDetail(container, tourId) {
            const tour = TOURS.find(t => t.id === tourId);
            if (!tour) return router.navigate('tours');

            container.innerHTML = `
                <div class="container mx-auto px-4 py-6 animate-fade-in">
                    <button onclick="router.navigate('tours')" 
                            class="text-slate hover:text-electric mb-6 flex items-center text-xs uppercase tracking-widest transition mobile-tap">
                        <i class="fa-solid fa-arrow-left mr-2"></i> Back to Escapes
                    </button>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-2 space-y-8">
                            <div class="rounded-2xl overflow-hidden shadow-xl h-[300px] md:h-[400px] relative">
                                <img src="${tour.image}" class="w-full h-full object-cover">
                                <div class="absolute inset-0 bg-gradient-to-t from-midnight/80 to-transparent"></div>
                                <div class="absolute bottom-6 left-6">
                                    <h1 class="font-serif text-3xl md:text-4xl text-white mb-2">${tour.title}</h1>
                                    <div class="flex flex-wrap gap-4 text-sm text-white/90 font-bold">
                                        <span class="flex items-center"><i class="fa-solid fa-map-pin mr-2 text-teagreen"></i>${tour.region}</span>
                                        <span class="flex items-center"><i class="fa-regular fa-clock mr-2 text-teagreen"></i>${tour.duration}</span>
                                        <span class="flex items-center"><i class="fa-solid fa-star mr-2 text-teagreen"></i>${tour.rating} Rating</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white p-6 md:p-8 rounded-2xl shadow-sm border border-electric/10">
                                <h3 class="font-serif text-2xl text-midnight mb-4">Experience Overview</h3>
                                <p class="text-slate leading-relaxed mb-8">${tour.desc}</p>
                                
                                <h3 class="font-serif text-xl text-midnight mb-4">Tour Highlights</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    ${tour.highlights.map((h, i) => `
                                        <div class="flex items-center bg-teagreen/20 p-4 rounded-xl border border-teagreen/30 text-midnight text-sm font-semibold">
                                            <div class="w-8 h-8 rounded-full bg-teagreen text-midnight flex items-center justify-center mr-3 font-bold">${i + 1}</div>
                                            ${h}
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>

                        <div class="lg:col-span-1">
                            <div class="bg-white p-6 md:p-8 rounded-2xl sticky top-24 border border-electric/10 shadow-xl">
                                <div class="text-center mb-8 border-b border-electric/10 pb-8">
                                    <p class="text-slate text-xs uppercase tracking-widest font-bold">Package Price</p>
                                    <p class="text-3xl md:text-4xl font-serif text-sunset mt-2 font-bold">₹${(tour.price * 1.05).toLocaleString()}</p>
                                    <p class="text-xs text-slate mt-1">All inclusive • Taxes included</p>
                                </div>
                                
                                <div class="space-y-4 mb-8">
                                    <div class="flex items-center text-sm text-slate">
                                        <i class="fa-solid fa-check text-teagreen mr-3 w-5"></i>
                                        <span>Instant Confirmation</span>
                                    </div>
                                    <div class="flex items-center text-sm text-slate">
                                        <i class="fa-solid fa-shield-halved text-teagreen mr-3 w-5"></i>
                                        <span>Secure Payment Gateway</span>
                                    </div>
                                    <div class="flex items-center text-sm text-slate">
                                        <i class="fa-solid fa-user-tie text-teagreen mr-3 w-5"></i>
                                        <span>Expert Local Guide</span>
                                    </div>
                                </div>
                                
                                <button onclick="router.navigate('booking', '${tour.id}')" 
                                        class="w-full gradient-sunset text-white py-4 rounded-xl font-bold uppercase tracking-widest text-xs hover:opacity-90 transition shadow-lg mobile-tap">
                                    <i class="fa-solid fa-calendar-check mr-2"></i>Book Now
                                </button>
                                
                                <div class="text-center mt-6">
                                    <p class="text-xs text-slate">
                                        <i class="fa-solid fa-phone-volume mr-2 text-electric"></i>
                                        Need help? Call +91 8080062440
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>`;
        }

        function renderBooking(container, tourId) {
            const tour = TOURS.find(t => t.id === tourId);
            const total = Math.round(tour.price * 1.05);

            container.innerHTML = `
                <div class="max-w-2xl mx-auto py-8 px-4 animate-slide-in">
                    <div class="bg-white p-6 md:p-8 rounded-2xl border border-electric/10 shadow-xl">
                        <div class="mb-8">
                            <h2 class="font-serif text-2xl md:text-3xl text-midnight mb-2">Complete Your Booking</h2>
                            <p class="text-slate text-sm">Finalize your reservation for ${tour.title}</p>
                        </div>
                        
                        <form onsubmit="handleTourBookingSubmit(event, '${tour.id}', ${total})" class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="text-xs text-slate uppercase font-bold tracking-wider mb-2 block">Full Name *</label>
                                    <input name="name" required 
                                           class="w-full bg-cream border border-electric/20 rounded-xl p-4 text-midnight focus:border-electric focus:ring-2 focus:ring-electric/20 outline-none mobile-tap"
                                           placeholder="Enter your full name">
                                </div>
                                <div>
                                    <label class="text-xs text-slate uppercase font-bold tracking-wider mb-2 block">Phone *</label>
                                    <input name="phone" type="tel" required 
                                           class="w-full bg-cream border border-electric/20 rounded-xl p-4 text-midnight focus:border-electric focus:ring-2 focus:ring-electric/20 outline-none mobile-tap"
                                           placeholder="+91 00000 00000">
                                </div>
                            </div>
                            
                            <div class="bg-teagreen/10 p-6 rounded-xl border border-dashed border-teagreen">
                                <div class="text-center mb-4">
                                    <p class="text-midnight font-bold">Total Amount: <span class="text-sunset text-xl">₹${total.toLocaleString()}</span></p>
                                    <p class="text-xs text-slate">Includes all taxes and fees</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-sm font-bold text-midnight mb-3">Scan to Pay via UPI</p>
                                    <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=upi://pay?pa=7743805933@upi&pn=Gaanyogi&am=${total}&cu=INR&tn=Tour%20Booking%20${tour.title}" 
                                         class="w-40 h-40 mx-auto rounded-lg mb-3 border border-electric/20"
                                         alt="UPI QR Code">
                                    <p class="text-xs text-slate">UPI ID: 7743805933@upi</p>
                                </div>
                            </div>

                            <div class="bg-electric/10 text-midnight p-4 rounded-lg text-xs flex gap-3 items-start">
                                <i class="fa-brands fa-whatsapp text-teagreen text-base mt-0.5"></i> 
                                <div>
                                    <p class="font-bold mb-1">WhatsApp Confirmation</p>
                                    <p>After payment, share payment screenshot on WhatsApp for booking confirmation.</p>
                                </div>
                            </div>

                            <button type="submit" 
                                    class="w-full gradient-sunset text-white py-4 rounded-xl font-bold uppercase tracking-widest text-xs hover:opacity-90 transition shadow-lg mobile-tap">
                                <i class="fa-solid fa-lock mr-2"></i>I Have Made the Payment
                            </button>
                        </form>
                    </div>
                </div>`;
        }

        function renderAdmin(container) {
            if (!state.isAdminVerified) {
                container.innerHTML = `
                    <div class="flex items-center justify-center min-h-[70vh] animate-fade-in">
                        <div class="bg-white p-8 rounded-2xl border border-electric/10 w-full max-w-sm mx-4 shadow-xl">
                            <div class="w-16 h-16 gradient-bg rounded-full flex items-center justify-center mx-auto mb-6 text-white text-2xl">
                                <i class="fa-solid fa-lock"></i>
                            </div>
                            <h2 class="font-serif text-2xl text-midnight mb-2 text-center">Admin Access</h2>
                            <p class="text-slate text-sm text-center mb-6">Enter passkey to continue</p>
                            <form onsubmit="handleAdminLogin(event)">
                                <input type="password" id="admin-password-input" 
                                       class="w-full bg-cream border border-electric/20 rounded-xl p-4 text-midnight text-center mb-4 focus:border-electric focus:ring-2 focus:ring-electric/20 outline-none mobile-tap" 
                                       placeholder="Enter Passkey" 
                                       required
                                       autocomplete="off">
                                <button type="submit" 
                                        class="w-full gradient-sunset text-white py-3.5 rounded-xl font-bold text-xs uppercase tracking-widest hover:opacity-90 transition mobile-tap">
                                    <i class="fa-solid fa-key mr-2"></i>Unlock Dashboard
                                </button>
                            </form>
                        </div>
                    </div>`;
                return;
            }

            container.innerHTML = `
                <div class="container mx-auto px-4 py-8 animate-fade-in">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                        <div>
                            <h1 class="font-serif text-2xl md:text-3xl text-midnight mb-2">Admin Dashboard</h1>
                            <p class="text-slate text-sm">Manage bookings and monitor services</p>
                        </div>
                        <button onclick="state.isAdminVerified = false; router.navigate('admin')" 
                                class="bg-cream text-slate px-4 py-2.5 rounded-full text-xs font-bold uppercase tracking-wider hover:bg-electric/10 transition mobile-tap">
                            <i class="fa-solid fa-sign-out-alt mr-2"></i>Logout
                        </button>
                    </div>
                    
                    <div class="bg-white rounded-xl border border-electric/10 overflow-hidden shadow-lg">
                        <div class="p-6 border-b border-electric/10">
                            <h3 class="font-serif text-xl text-midnight">Recent Bookings</h3>
                            <p class="text-slate text-sm">Latest tour and ride bookings</p>
                        </div>
                        <div class="overflow-x-auto hide-scrollbar">
                            <table class="w-full text-sm text-left text-slate min-w-[600px]">
                                <thead class="text-xs text-midnight uppercase bg-cream">
                                    <tr>
                                        <th class="px-6 py-4">Customer</th>
                                        <th class="px-6 py-4">Service</th>
                                        <th class="px-6 py-4">Amount</th>
                                        <th class="px-6 py-4">Status</th>
                                        <th class="px-6 py-4">Date</th>
                                        <th class="px-6 py-4">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="admin-table-body">
                                    <tr><td colspan="6" class="p-6 text-center text-slate">Loading bookings...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>`;
            
            loadAdminBookings();
        }

        function renderBookingModal() {
            const v = state.ride.selectedVehicle;
            const isFixed = !!state.ride.fixedPrice;
            const fare = state.ride.fixedPrice || Math.round(state.ride.distance * v.rate);
            
            const modalHTML = `
            <div class="fixed inset-0 z-[80] flex items-end md:items-center justify-center p-4 animate-fade-in">
                <div class="absolute inset-0 bg-midnight/70 backdrop-blur-sm" onclick="closeBookingModal()"></div>
                <div class="relative w-full md:max-w-md bg-white rounded-2xl shadow-2xl p-6 md:p-8 animate-slide-in max-h-[90vh] overflow-y-auto hide-scrollbar">
                    <button onclick="closeBookingModal()" 
                            class="absolute right-4 top-4 text-slate hover:text-electric mobile-tap">
                        <i class="fa-solid fa-xmark text-lg"></i>
                    </button>
                    
                    <h2 class="text-xl font-serif text-midnight mb-2">Confirm Ride Request</h2>
                    <p class="text-slate text-sm mb-6">Complete booking details</p>
                    
                    <div class="flex items-center gap-4 bg-cream p-4 rounded-xl mb-6 border border-electric/20">
                        <div class="w-20 h-16 rounded-lg overflow-hidden">
                            <img src="${v.img}" class="w-full h-full object-cover">
                        </div>
                        <div class="flex-1">
                            <h3 class="text-midnight font-bold text-sm">${v.name}</h3>
                            <p class="text-sunset font-bold text-sm">₹${fare.toLocaleString()}</p>
                            <p class="text-slate text-xs">${isFixed ? 'Fixed Price Offer' : `${state.ride.distance.toFixed(1)} km × ₹${v.rate}/km`}</p>
                        </div>
                    </div>

                    <form onsubmit="submitRideBooking(event)" class="space-y-4">
                        <div>
                            <label class="text-xs text-slate uppercase font-bold tracking-wider mb-2 block">Full Name *</label>
                            <input name="customerName" required 
                                   class="w-full bg-cream border border-electric/20 rounded-lg p-3 text-midnight focus:border-electric focus:ring-2 focus:ring-electric/20 outline-none text-sm mobile-tap" 
                                   placeholder="Enter your full name">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-xs text-slate uppercase font-bold tracking-wider mb-2 block">Phone *</label>
                                <input name="customerPhone" type="tel" required 
                                       class="w-full bg-cream border border-electric/20 rounded-lg p-3 text-midnight focus:border-electric focus:ring-2 focus:ring-electric/20 outline-none text-sm mobile-tap" 
                                       placeholder="+91">
                            </div>
                            <div>
                                <label class="text-xs text-slate uppercase font-bold tracking-wider mb-2 block">Passengers *</label>
                                <input name="passengers" type="number" min="1" max="${v.seats || 6}" value="1" required 
                                       class="w-full bg-cream border border-electric/20 rounded-lg p-3 text-midnight focus:border-electric focus:ring-2 focus:ring-electric/20 outline-none text-sm mobile-tap">
                            </div>
                        </div>
                        
                        <button type="submit" 
                                class="w-full gradient-sunset text-white font-bold py-4 rounded-xl hover:opacity-90 uppercase text-xs tracking-widest shadow-lg mobile-tap">
                            <i class="fa-solid fa-paper-plane mr-2"></i>Confirm & Send Request
                        </button>
                    </form>
                </div>
            </div>`;
            
            document.getElementById('modal-container').innerHTML = modalHTML;
        }

        // Business Logic Functions
        async function estimateRide() {
            const pickup = document.getElementById('pickup-input')?.value.trim();
            const drop = document.getElementById('drop-input')?.value.trim();
            
            if(!pickup || !drop) {
                showToast("Please enter both pickup and destination locations", "error");
                return;
            }

            state.ride.loading = true;
            state.ride.pickup = pickup;
            state.ride.drop = drop;
            renderRides(document.getElementById('app-root'));

            setTimeout(() => {
                const distance = 10 + Math.random() * 140;
                state.ride.distance = parseFloat(distance.toFixed(1));
                state.ride.step = 'LIST';
                state.ride.loading = false;
                renderRides(document.getElementById('app-root'));
                showToast(`Distance calculated: ${state.ride.distance} km`, "success");
            }, 1500);
        }

        function bookOffer(offerId) {
            const offer = RIDE_OFFERS.find(o => o.id === offerId);
            if (!offer) return;
            
            const vehicle = VEHICLES.find(v => v.name.includes(offer.vehicle.split(' ')[0])) || VEHICLES[0];
            state.ride.selectedVehicle = vehicle;
            state.ride.pickup = offer.from;
            state.ride.drop = offer.to;
            state.ride.fixedPrice = offer.price;
            renderBookingModal();
        }

        function openBookingModal(vehicleId) {
            state.ride.selectedVehicle = VEHICLES.find(v => v.id === vehicleId);
            state.ride.fixedPrice = null;
            renderBookingModal();
        }

        function closeBookingModal() {
            document.getElementById('modal-container').innerHTML = '';
            state.ride.selectedVehicle = null;
        }

        async function submitRideBooking(e) {
            e.preventDefault();
            const form = e.target;
            const btn = form.querySelector('button[type="submit"]');
            const originalText = btn.innerHTML;
            
            btn.innerHTML = '<div class="loader w-5 h-5 inline-block"></div> Processing...';
            btn.disabled = true;
            
            try {
                const fare = state.ride.fixedPrice || Math.round(state.ride.distance * state.ride.selectedVehicle.rate);
                
                const booking = {
                    type: 'RIDE',
                    customerName: form.customerName.value.trim(),
                    phone: form.customerPhone.value.trim(),
                    passengers: parseInt(form.passengers.value),
                    pickup: state.ride.pickup,
                    drop: state.ride.drop,
                    vehicle: state.ride.selectedVehicle.name,
                    amount: fare,
                    distance: state.ride.distance,
                    status: 'REQUESTED',
                    createdAt: serverTimestamp(),
                    userId: state.user?.uid || 'guest'
                };

                await addDoc(collection(db, 'bookings'), booking);
                
                const message = `*New Ride Request - GAANYOGI*\n\nName: ${booking.customerName}\nPhone: ${booking.phone}\nPickup: ${booking.pickup}\nDrop: ${booking.drop}\nVehicle: ${booking.vehicle}\nAmount: ₹${booking.amount}`;

                window.open(`https://wa.me/918080062440?text=${encodeURIComponent(message)}`, '_blank');
                
                showToast("Ride request sent successfully!", "success");
                closeBookingModal();
                
                state.ride = {
                    step: 'INPUT',
                    pickup: '',
                    drop: '',
                    distance: 0,
                    loading: false,
                    selectedVehicle: null,
                    fixedPrice: null
                };
                
                setTimeout(() => router.navigate('rides'), 1000);
                
            } catch (error) {
                console.error("Booking error:", error);
                showToast("Error processing booking. Please try again.", "error");
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        async function handleTourBookingSubmit(e, tourId, total) {
            e.preventDefault();
            const form = e.target;
            const btn = form.querySelector('button[type="submit"]');
            const originalText = btn.innerHTML;
            
            btn.innerHTML = '<div class="loader w-5 h-5 inline-block"></div> Processing...';
            btn.disabled = true;
            
            try {
                const tour = TOURS.find(t => t.id === tourId);
                
                const booking = {
                    type: 'TOUR',
                    tourId: tourId,
                    tourName: tour.title,
                    customerName: form.name.value.trim(),
                    phone: form.phone.value.trim(),
                    amount: total,
                    status: 'PENDING',
                    paymentMethod: 'UPI',
                    createdAt: serverTimestamp(),
                    userId: state.user?.uid || 'guest'
                };

                await addDoc(collection(db, 'bookings'), booking);

                const message = `*New Tour Booking - GAANYOGI*\n\nTour: ${tour.title}\nCustomer: ${booking.customerName}\nPhone: ${booking.phone}\nAmount Paid: ₹${booking.amount}`;

                window.open(`https://wa.me/918080062440?text=${encodeURIComponent(message)}`, '_blank');
                
                showToast("Booking submitted successfully!", "success");
                
                setTimeout(() => router.navigate('home'), 1500);
                
            } catch (error) {
                console.error("Tour booking error:", error);
                showToast("Error processing booking. Please try again.", "error");
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        async function loadAdminBookings() {
            try {
                const q = query(
                    collection(db, 'bookings'),
                    orderBy('createdAt', 'desc'),
                    limit(20)
                );
                
                onSnapshot(q, (snapshot) => {
                    const bookings = [];
                    snapshot.forEach((doc) => {
                        bookings.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    updateAdminUI(bookings);
                });
                
            } catch (error) {
                console.error("Error loading bookings:", error);
                const tbody = document.getElementById('admin-table-body');
                if (tbody) {
                    tbody.innerHTML = '<tr><td colspan="6" class="p-6 text-center text-sunset">Error loading data</td></tr>';
                }
            }
        }

        async function updateBookingStatus(bookingId, status) {
            if (!confirm(`Mark booking as ${status}?`)) return;
            
            try {
                const bookingRef = doc(db, 'bookings', bookingId);
                await updateDoc(bookingRef, {
                    status: status,
                    updatedAt: serverTimestamp()
                });
                
                showToast(`Booking marked as ${status}`, "success");
            } catch (error) {
                console.error("Error updating booking:", error);
                showToast("Error updating booking", "error");
            }
        }

        function updateAdminUI(bookings) {
            const tbody = document.getElementById('admin-table-body');
            if (!tbody) return;
            
            if (!bookings || bookings.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="p-6 text-center text-slate">No bookings found</td></tr>';
                return;
            }
            
            const rows = bookings.map(booking => {
                const date = booking.createdAt?.toDate ? booking.createdAt.toDate() : new Date();
                
                return `
                <tr class="border-b border-cream hover:bg-cream/50 transition">
                    <td class="px-6 py-4">
                        <div class="font-bold text-midnight">${booking.customerName}</div>
                        <div class="text-xs text-slate">${booking.phone}</div>
                    </td>
                    <td class="px-6 py-4">
                        <span class="font-medium ${booking.type === 'RIDE' ? 'text-electric' : 'text-sunset'}">${booking.type}</span>
                        ${booking.tourName ? `<div class="text-xs text-slate">${booking.tourName}</div>` : ''}
                    </td>
                    <td class="px-6 py-4 font-bold text-sunset">₹${booking.amount?.toLocaleString() || '0'}</td>
                    <td class="px-6 py-4">
                        <span class="px-3 py-1 rounded-full text-[10px] font-bold uppercase
                            ${booking.status === 'CONFIRMED' || booking.status === 'PAID' ? 'bg-teagreen/20 text-teagreen' : 
                              booking.status === 'CANCELLED' ? 'bg-sunset/20 text-sunset' : 
                              'bg-electric/20 text-electric'}">
                            ${booking.status || 'PENDING'}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-xs text-slate">${date.toLocaleDateString()}</td>
                    <td class="px-6 py-4">
                        <button onclick="updateBookingStatus('${booking.id}', 'CONFIRMED')" 
                                class="text-teagreen hover:text-teagreen/80 text-xs uppercase font-bold mobile-tap">
                            Confirm
                        </button>
                    </td>
                </tr>
                `;
            }).join('');
            
            tbody.innerHTML = rows;
        }

        // Utility Functions
        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            if (!container) return;
            
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-teagreen/10 border-teagreen' : 
                           type === 'error' ? 'bg-sunset/10 border-sunset' : 
                           'bg-electric/10 border-electric';
            const textColor = type === 'success' ? 'text-teagreen' : 
                             type === 'error' ? 'text-sunset' : 
                             'text-electric';
            
            toast.className = `${bgColor} border-l-4 p-4 rounded-r-lg shadow-lg text-sm animate-slide-in flex items-center gap-3 ${textColor} font-medium`;
            
            const icon = type === 'success' ? 'fa-check-circle' : 
                        type === 'error' ? 'fa-exclamation-circle' : 
                        'fa-info-circle';
            
            toast.innerHTML = `
                <i class="fa-solid ${icon}"></i>
                <span>${message}</span>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('opacity-0', 'transition-opacity', 'duration-300');
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        function toggleChat() {
            document.getElementById('chat-window').classList.toggle('hidden');
        }

        function toggleMobileMenu() {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        }

        function handleAdminLogin(e) {
            e.preventDefault();
            const password = document.getElementById('admin-password-input').value;
            
            if (password === 'admin123' || password === 'Aakash@gaanyogi') {
                state.isAdminVerified = true;
                router.navigate('admin');
                showToast("Admin access granted", "success");
            } else {
                showToast("Invalid passkey", "error");
            }
        }

        function handleChatSend() {
            const input = document.getElementById('chat-input');
            const msgs = document.getElementById('chat-messages');
            const text = input.value.trim();
            
            if (!text) return;
            
            msgs.innerHTML += `<div class="flex justify-end animate-slide-in"><div class="gradient-sunset text-white p-3 rounded-2xl rounded-tr-none max-w-[85%] text-sm">${text}</div></div>`;
            input.value = '';
            
            setTimeout(() => {
                const responses = [
                    "For that destination, I recommend comfortable walking shoes and light clothing.",
                    "The best time to visit is between November and February for pleasant weather.",
                    "Yes, we can customize that itinerary. Contact our concierge desk for details.",
                    "That tour includes all meals and accommodation. Perfect choice!",
                    "I suggest carrying some cash as smaller shops may not accept cards."
                ];
                
                const response = responses[Math.floor(Math.random() * responses.length)];
                
                msgs.innerHTML += `<div class="flex justify-start animate-slide-in"><div class="bg-white p-3 rounded-2xl rounded-tl-none border border-electric/20 max-w-[85%] text-sm text-midnight">${response}</div></div>`;
                msgs.scrollTop = msgs.scrollHeight;
            }, 1000);
            
            msgs.scrollTop = msgs.scrollHeight;
        }

        // Initialize Application
        window.addEventListener('load', async () => {
            await initAuth();
            router.navigate('home');
            
            // Make functions globally available
            window.router = router;
            window.estimateRide = estimateRide;
            window.bookOffer = bookOffer;
            window.openBookingModal = openBookingModal;
            window.closeBookingModal = closeBookingModal;
            window.submitRideBooking = submitRideBooking;
            window.handleTourBookingSubmit = handleTourBookingSubmit;
            window.updateBookingStatus = updateBookingStatus;
            window.handleAdminLogin = handleAdminLogin;
            window.toggleChat = toggleChat;
            window.toggleMobileMenu = toggleMobileMenu;
            window.handleChatSend = handleChatSend;

            // Add smooth scrolling to all links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({ behavior: 'smooth' });
                    }
                });
            });

            // Close mobile menu when clicking outside
            document.addEventListener('click', (e) => {
                const menu = document.getElementById('mobile-menu');
                const menuBtn = document.querySelector('button[onclick="toggleMobileMenu()"]');
                
                if (!menu.classList.contains('hidden') && 
                    !menu.contains(e.target) && 
                    menuBtn && !menuBtn.contains(e.target)) {
                    menu.classList.add('hidden');
                }
            });

            // Test Firebase connection button
            const testBtn = document.createElement('button');
            testBtn.innerHTML = '<i class="fa-solid fa-bolt"></i>';
            testBtn.className = 'fixed bottom-24 right-4 z-50 gradient-bg text-white w-10 h-10 rounded-full flex items-center justify-center shadow-lg hover:scale-110 transition';
            testBtn.onclick = async () => {
                try {
                    await addDoc(collection(db, 'test'), {
                        test: "Firebase connection test",
                        timestamp: serverTimestamp()
                    });
                    showToast("Firebase connected successfully!", "success");
                } catch (error) {
                    console.error("Firebase test failed:", error);
                    showToast("Firebase connection failed", "error");
                }
            };
            document.body.appendChild(testBtn);
        });

        // Prevent zoom on mobile
        document.addEventListener('touchstart', (e) => {
            if (e.touches.length > 1) e.preventDefault();
        }, { passive: false });
    </script>
</body>
</html>
